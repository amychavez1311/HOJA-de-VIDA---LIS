{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{ perfil.nombres }} - Hoja de Vida Interactiva</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        :root {
            --lila-oscuro: #5a189a;
            --lila-medio: #9d4edd;
            --lila-claro: #e0aaff;
            --lila-fondo: #f8f4ff;
            --rosa-pastel: #fff0f5; 
            --dorado-brillo: linear-gradient(90deg, transparent, #fbbf24, transparent);
            --oro-hada: #ffd700;
            --glow-text: 0 0 12px rgba(157, 78, 221, 0.6), 0 0 25px rgba(224, 170, 255, 0.4);
        }

        body { 
            background-color: #f3e5f5; 
            font-family: 'Segoe UI', sans-serif;
            scroll-behavior: smooth;
            background-image: radial-gradient(circle, rgba(255,215,0,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            overflow-x: hidden;
        }

        /* --- IMPLEMENTACI√ìN DE ADAS FLOTANTES --- */
        .fairy-float {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            animation: fairy-move 10s infinite ease-in-out;
            filter: drop-shadow(0 0 10px gold);
        }

        @keyframes fairy-move {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(100px, 50px) rotate(10deg); }
            50% { transform: translate(50px, 200px) rotate(-10deg); }
            75% { transform: translate(-50px, 100px) rotate(5deg); }
        }

        /* --- POLVOS M√ÅGICOS FLOTANTES --- */
        .magic-dust {
            position: fixed;
            width: 4px; height: 4px;
            background: gold;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 10px 2px white;
            animation: dust-float 5s infinite;
            opacity: 0;
        }

        @keyframes dust-float {
            0% { transform: translateY(0); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
        }

        /* --- LETRAS CON BRILLO (REDUCIDAS 1 PUNTO) --- */
        h1 { font-size: 2.5rem !important; animation: text-glow 3s infinite alternate; }
        h2 { font-size: 1.75rem !important; animation: text-glow 4s infinite alternate; }
        h3 { font-size: 1.5rem !important; }
        h4, .section-title { font-size: 1.2rem !important; }

        @keyframes text-glow {
            from { text-shadow: 0 0 5px #fff, 0 0 10px var(--lila-claro); }
            to { text-shadow: 0 0 15px #fff, 0 0 25px var(--oro-hada), 0 0 10px var(--lila-medio); }
        }

        .navbar-magic {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--lila-claro);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-link {
            color: var(--lila-oscuro) !important;
            font-weight: 600;
            transition: 0.3s;
        }

        .cv-long-page {
            max-width: 900px;
            margin: 0 auto;
            background: var(--rosa-pastel);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            padding-bottom: 50px;
            overflow: hidden;
        }

        .section-padding { padding: 60px 80px; position: relative; }

        .photo-container {
            position: relative; display: inline-block; padding: 18px;
        }

        .photo-container::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 50%; border: 2px dotted var(--oro-hada);
            animation: rotate-fairy-dust 8s linear infinite;
        }

        .fairy-sparkle {
            position: absolute; color: var(--oro-hada); font-size: 1.4rem;
            animation: blink-sparkle 2s infinite alternate; z-index: 5;
            text-shadow: 0 0 12px gold;
        }

        @keyframes rotate-fairy-dust { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes blink-sparkle { 0% { opacity: 0.2; transform: scale(0.6); } 100% { opacity: 1; transform: scale(1.3); } }

        .profile-img {
            width: 160px; height: 160px; object-fit: cover;
            border-radius: 50%; border: 6px solid white;
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.3);
            position: relative; z-index: 2;
        }

        .section-title { 
            border-bottom: 2px solid var(--lila-medio); 
            margin-bottom: 20px; padding-bottom: 8px; 
            text-transform: uppercase; color: var(--lila-oscuro);
        }

        .magic-divider {
            height: 2px; width: 80%; margin: 0 auto;
            background: var(--dorado-brillo); position: relative; opacity: 0.6;
        }

        .magic-divider::after { content: "‚ú®"; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); }

        .tinker { position: absolute; width: 80px; filter: drop-shadow(0 0 8px gold); z-index: 10; }

        .product-card {
            border: none; border-radius: 15px; transition: 0.3s;
            background: #fff; border: 1px solid var(--lila-claro);
        }

        .product-img {
            height: 180px; width: 100%; object-fit: cover;
            border-bottom: 2px solid var(--lila-claro);
        }

        .floating-badge {
            display: inline-block;
            animation: float-icon 2.5s ease-in-out infinite;
        }

        @keyframes float-icon {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .project-links a {
            text-decoration: none; color: var(--lila-medio);
            font-weight: 600; margin-right: 15px;
        }

        @media print {
            .no-print, .navbar-magic, .fairy-float, .magic-dust { display: none !important; }
            .cv-long-page { box-shadow: none; max-width: 100%; margin: 0; background-color: var(--rosa-pastel) !important; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>

    <img src="https://img.icons8.com/color/96/tinker-bell.png" class="fairy-float" style="top: 20%; left: 5%;">
    <img src="https://img.icons8.com/color/96/tinker-bell.png" class="fairy-float" style="top: 60%; right: 5%; animation-delay: -5s; transform: scaleX(-1);">

    <div class="magic-dust" style="left: 10%; animation-delay: 0s;"></div>
    <div class="magic-dust" style="left: 30%; animation-delay: 2s;"></div>
    <div class="magic-dust" style="left: 50%; animation-delay: 1s;"></div>
    <div class="magic-dust" style="left: 80%; animation-delay: 3s;"></div>

    <nav class="navbar navbar-expand-lg navbar-magic no-print">
        <div class="container">
            <a class="navbar-brand text-primary fw-bold" href="#"><i class="bi bi-house-heart"></i> Inicio ‚ú®</a>
            <div class="collapse navbar-collapse justify-content-center">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="#seccion-perfil">Perfil</a></li>
                    <li class="nav-item"><a class="nav-link" href="#seccion-experiencia">Experiencia</a></li>
                    <li class="nav-item"><a class="nav-link" href="#seccion-educacion">Educaci√≥n</a></li>
                    <li class="nav-item"><a class="nav-link" href="#seccion-habilidades">Habilidades</a></li>
                    <li class="nav-item"><a class="nav-link" href="#seccion-proyectos">Proyectos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#seccion-tienda">Venta de Garaje</a></li>
                    <li class="nav-item"><a class="nav-link" href="#seccion-referencias">Referencias</a></li>
                </ul>
            </div>
            <button class="btn btn-primary btn-sm rounded-pill px-4 shadow" data-bs-toggle="modal" data-bs-target="#printModal">
                <i class="bi bi-download"></i> Descargar PDF
            </button>
        </div>
    </nav>

    <div class="cv-long-page">
        
        <div id="seccion-perfil" class="section-padding position-relative">
            <img src="https://img.icons8.com/color/96/tinker-bell.png" class="tinker" style="top: 20px; right: 20px;">
            <div class="d-flex align-items-center mb-5 mt-4">
                <div class="me-5">
                    <div class="photo-container">
                        <span class="fairy-sparkle" style="top:-5px; left:10px;">‚ú®</span>
                        <span class="fairy-sparkle" style="bottom:10px; right:-5px;">‚ú®</span>
                        {% if perfil.foto %}<img src="{{ perfil.foto.url }}" class="profile-img">{% endif %}
                    </div>
                </div>
                <div>
                    <h1>{{ perfil.nombres }}<br>
                    <span style="color: var(--lila-medio); font-weight: 300;">{{ perfil.apellidos }}</span></h1>
                </div>
            </div>
            <div class="row">
                <div class="col-4">
                    <div class="p-3 rounded-4 border bg-white shadow-sm" style="background-color: rgba(255,255,255,0.6) !important;">
                        <h4 class="section-title">Contacto ‚ú®</h4>
                        <p class="small"><strong>C√©dula:</strong> {{ perfil.cedula }}</p>
                        <p class="small"><strong>Tel√©fono:</strong> {{ perfil.telefono }}</p>
                        <p class="small"><strong>Correo electr√≥nico:</strong> {{ perfil.email }}</p>
                        <p class="small"><strong>Origen:</strong> {{ perfil.lugar_nacimiento }}</p>
                    </div>
                </div>
                <div class="col-8">
                    <h4 class="section-title">Sobre M√≠</h4>
                    <p style="text-align: justify;">{{ perfil.descripcion|linebreaksbr }}</p>
                </div>
            </div>
        </div>

        <div class="magic-divider"></div>

        <div id="seccion-experiencia" class="section-padding">
            <h2 class="section-title mt-4">Experiencia Laboral</h2>
            {% for exp in experiencias %}
            <div class="mb-4 p-3 border-start border-4 border-info bg-white shadow-sm" style="background-color: rgba(255,255,255,0.6) !important;">
                <h5 style="color: var(--lila-oscuro); font-weight: 700;">‚ú® {{ exp.cargo }}</h5>
                <p class="mb-1 fw-bold">{{ exp.empresa }}</p>
                <p class="small text-muted mb-2">{{ exp.fecha_inicio }} - {{ exp.fecha_fin|default:"Actualidad" }}</p>
                <p class="small mb-0">{{ exp.descripcion|linebreaksbr }}</p>
            </div>
            {% empty %}
            <p class="text-muted">No hay experiencia laboral registrada.</p>
            {% endfor %}
        </div>

        <div class="magic-divider"></div>

        <div id="seccion-educacion" class="section-padding">
            <h2 class="section-title mt-4">Educaci√≥n</h2>
            {% for edu in educaciones %}
            <div class="mb-4 p-3 border-start border-4 border-primary bg-white shadow-sm" style="background-color: rgba(255,255,255,0.6) !important;">
                <h5 style="color: var(--lila-oscuro);">üéì {{ edu.institucion }}</h5>
                <p class="mb-0">{{ edu.titulo }}</p>
                <small class="text-muted">{{ edu.fecha_inicio }} - {{ edu.fecha_fin|default:"Hoy" }}</small>
            </div>
            {% endfor %}
        </div>

        <div class="magic-divider"></div>

        <div id="seccion-habilidades" class="section-padding">
            <h2 class="section-title mt-4">Habilidades</h2>
            <div class="row mt-4">
                {% for hab in habilidades %}
                <div class="col-4 mb-3">
                    <div class="p-3 border rounded text-center bg-white shadow-sm">‚ú® {{ hab.nombre }}</div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="magic-divider"></div>

        <div id="seccion-proyectos" class="section-padding">
            <h2 class="section-title mt-4">Proyectos</h2>
            {% for pro in proyectos %}
            <div class="card mb-3 border-0 shadow-sm" style="background-color: rgba(255,255,255,0.6) !important;">
                <div class="card-body">
                    <h4 style="color: var(--lila-oscuro);">‚≠ê {{ pro.nombre }}</h4>
                    <p>{{ pro.descripcion }}</p>
                    <div class="project-links mt-2">
                        {% if pro.github %}<a href="{{ pro.github }}" target="_blank"><i class="bi bi-github"></i> Github</a>{% endif %}
                        {% if pro.demo %}<a href="{{ pro.demo }}" target="_blank"><i class="bi bi-laptop"></i> Ver Demo</a>{% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="magic-divider"></div>

        <div id="seccion-certificados" class="section-padding">
            <h2 class="section-title mt-4">Certificados y Reconocimientos ‚ú®</h2>
            <div class="row mt-4">
                {% for cert in certificados %}
                <div class="col-md-6 mb-4">
                    <div class="card product-card h-100 shadow-sm text-center">
                        <div style="height: 200px; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #fff; border-bottom: 1px solid var(--lila-claro);">
                            {% if cert.imagen %}
                                <img src="{{ cert.imagen.url }}" style="max-height: 100%; max-width: 100%; object-fit: contain;" alt="{{ cert.titulo }}">
                            {% else %}
                                <i class="bi bi-patch-check fs-1 text-muted"></i>
                            {% endif %}
                        </div>
                        <div class="card-body">
                            <h5 style="color: var(--lila-oscuro); font-weight: 700;">{{ cert.titulo }}</h5>
                            <p class="mb-1 small"><strong>Instituci√≥n:</strong> {{ cert.institucion }}</p>
                            <p class="mb-0 small text-muted"><strong>Fecha:</strong> {{ cert.fecha|date:"d \d\e F \d\e Y" }}</p>
                            {% if cert.imagen %}
                            <div class="mt-3">
                                <a href="{{ cert.imagen.url }}" target="_blank" class="btn btn-outline-primary btn-sm rounded-pill">
                                    <i class="bi bi-eye"></i> Ver Certificado
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center mt-4">
                    <p class="text-muted">No hay certificados registrados.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="magic-divider"></div>

        <div id="seccion-tienda" class="section-padding position-relative">
            <img src="https://img.icons8.com/color/96/tinker-bell.png" class="tinker" style="bottom: 20px; left: 20px; transform: scaleX(-1);">
            <h2 class="section-title mt-4 text-center">Venta de Garaje ‚ú®</h2>
            <div class="row mt-5">
                {% for producto in productos %}
                <div class="col-md-4 mb-4">
                    <div class="card product-card shadow-sm h-100 text-center">
                        {% if producto.imagen %}
                            <img src="{{ producto.imagen.url }}" class="product-img" alt="{{ producto.nombre_producto }}">
                        {% else %}
                            <img src="https://via.placeholder.com/300x200?text=Sin+Imagen" class="product-img" alt="Sin imagen">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 style="color: var(--lila-oscuro); font-weight: 700;">{{ producto.nombre_producto }}</h5>
                            <p class="fw-bold text-primary mb-2">${{ producto.precio }}</p>
                            <div class="mb-3">
                                <div class="floating-badge">
                                    {% if producto.estado == "Nuevo" %}
                                        <span class="badge rounded-pill bg-success px-3 py-2"><i class="bi bi-stars"></i> Nuevo</span>
                                    {% else %}
                                        <span class="badge rounded-pill bg-warning text-dark px-3 py-2"><i class="bi bi-recycle"></i> Usado</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="mt-auto">
                                <span class="badge rounded-pill bg-light text-dark border w-100 py-2">Disponible</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12 text-center mt-4">
                    <p class="text-muted">No se encontraron productos en la base de datos.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="magic-divider"></div>

        <div id="seccion-referencias" class="section-padding">
            <h2 class="section-title mt-4">Referencias Personales ‚ú®</h2>
            <div class="row">
                {% for ref in referencias %}
                <div class="col-md-6 mb-3">
                    <div class="p-3 border rounded bg-white shadow-sm" style="background-color: rgba(255,255,255,0.6) !important;">
                        <h5 style="color: var(--lila-oscuro); font-weight: 700;">‚ú® {{ ref.nombre }}</h5>
                        <p class="mb-0"><strong>Tel√©fono:</strong> {{ ref.telefono }}</p>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted text-center">No hay referencias registradas.</p>
                {% endfor %}
            </div>
        </div>

    </div>

    <div class="modal fade no-print" id="printModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white"><h5 class="modal-title">Configurar PDF ‚ú®</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-perfil" checked><label>Perfil</label></div>
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-experiencia" checked><label>Experiencia Laboral</label></div>
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-educacion" checked><label>Educaci√≥n</label></div>
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-habilidades" checked><label>Habilidades</label></div>
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-proyectos" checked><label>Proyectos</label></div>
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-certificados" checked><label>Certificados</label></div>
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-tienda" checked><label>Venta de Garaje</label></div>
                    <div class="form-check mb-2"><input class="form-check-input" type="checkbox" id="check-referencias" checked><label>Referencias</label></div>
                </div>
                <div class="modal-footer"><button class="btn btn-primary w-100" onclick="lanzarPDF()">Imprimir con Polvos M√°gicos ‚ú®</button></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function lanzarPDF() {
            const checks = [
                { id: 'seccion-perfil', chk: 'check-perfil' }, 
                { id: 'seccion-experiencia', chk: 'check-experiencia' },
                { id: 'seccion-educacion', chk: 'check-educacion' },
                { id: 'seccion-habilidades', chk: 'check-habilidades' }, 
                { id: 'seccion-proyectos', chk: 'check-proyectos' },
                { id: 'seccion-certificados', chk: 'check-certificados' }, 
                { id: 'seccion-tienda', chk: 'check-tienda' },
                { id: 'seccion-referencias', chk: 'check-referencias' }
            ];
            checks.forEach(c => {
                const el = document.getElementById(c.id);
                if (el) {
                    el.style.display = document.getElementById(c.chk).checked ? 'block' : 'none';
                    const nextEl = el.nextElementSibling;
                    if(nextEl && nextEl.classList.contains('magic-divider')) {
                        nextEl.style.display = el.style.display;
                    }
                    const prevEl = el.previousElementSibling;
                    if(prevEl && prevEl.classList.contains('magic-divider')) {
                        prevEl.style.display = el.style.display;
                    }
                }
            });
            bootstrap.Modal.getInstance(document.getElementById('printModal')).hide();
            setTimeout(() => { window.print(); }, 500);
        }
    </script>
</body>
</html>